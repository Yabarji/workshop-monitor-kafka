<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JMX Metrics | Workshop Monitoring Kafka</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Monitor your Cluster">
    <link rel="preload" href="/workshop-monitor-kafka/assets/css/0.styles.5b0f8516.css" as="style"><link rel="preload" href="/workshop-monitor-kafka/assets/js/app.c1555643.js" as="script"><link rel="preload" href="/workshop-monitor-kafka/assets/js/2.843781b4.js" as="script"><link rel="preload" href="/workshop-monitor-kafka/assets/js/10.40b61c77.js" as="script"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/11.37b5992f.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/12.f09c477e.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/13.167d9b4c.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/3.d8a31682.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/4.7d5f245c.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/5.7fa0133c.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/6.6e6270bc.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/7.e07765f4.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/8.e3e3c765.js"><link rel="prefetch" href="/workshop-monitor-kafka/assets/js/9.bfe72f8f.js">
    <link rel="stylesheet" href="/workshop-monitor-kafka/assets/css/0.styles.5b0f8516.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/workshop-monitor-kafka/" class="home-link router-link-active"><img src="/workshop-monitor-kafka/kafka-logo.png" alt="Workshop Monitoring Kafka" class="logo"> <span class="site-name can-hide">Workshop Monitoring Kafka</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/vgallet/workshop-monitoring-kafka" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/vgallet/workshop-monitoring-kafka" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/workshop-monitor-kafka/1_GETTING_STARTED.html" class="sidebar-link">Getting Started</a></li><li><a href="/workshop-monitor-kafka/2_MANUAL_CHECKS.html" class="sidebar-link">Manual Checks</a></li><li><a href="/workshop-monitor-kafka/3_INJECT_DATA.html" class="sidebar-link">Inject some data</a></li><li><a href="/workshop-monitor-kafka/3_OFF_THE_SHELF.html" class="sidebar-link">Off-the-shelf tools</a></li><li><a href="/workshop-monitor-kafka/4_JMX.html" aria-current="page" class="active sidebar-link">JMX Metrics</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/workshop-monitor-kafka/4_JMX.html#browsing-available-metrics" class="sidebar-link">Browsing available metrics</a></li><li class="sidebar-sub-header"><a href="/workshop-monitor-kafka/4_JMX.html#important-metrics" class="sidebar-link">Important metrics</a></li></ul></li><li><a href="/workshop-monitor-kafka/5_JMX_EXPORTER_PROMETHEUS.html" class="sidebar-link">JMX Exporter &amp; Prometheus</a></li><li><a href="/workshop-monitor-kafka/6_GRAFANA.html" class="sidebar-link">Grafana</a></li><li><a href="/workshop-monitor-kafka/10_GLOSSARY.html" class="sidebar-link">Glossary</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jmx-metrics"><a href="#jmx-metrics" class="header-anchor">#</a> JMX Metrics</h1> <p>By default, Apache Kafka brokers and clients expose a vast array of <a href="https://en.wikipedia.org/wiki/Java_Management_Extensions" target="_blank" rel="noopener noreferrer">JMX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> metrics.</p> <p>JMX is the acronym of Java Management Extensions. It's a standard to manage and monitor Java resources at runtime.</p> <h2 id="browsing-available-metrics"><a href="#browsing-available-metrics" class="header-anchor">#</a> Browsing available metrics</h2> <p><a href="https://docs.confluent.io/current/kafka/monitoring.html#server-metrics" target="_blank" rel="noopener noreferrer">This documentation page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> lists of available metrics on server side and on client side.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You should refer to <a href="https://docs.confluent.io/current/kafka/monitoring.html#server-metrics" target="_blank" rel="noopener noreferrer">this documentation page<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> if you're looking for a particular metric</p></div> <p>For this workshop, you are going to browse all available metrics directly on the broker <code>kafka-1</code>. As you may noticed, this broker is configured to enable JMX connection:</p> <div class="language- extra-class"><pre class="language-text"><code>-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.port=1098
-Dcom.sun.management.jmxremote.rmi.port=1098
-Djava.rmi.server.hostname=kafka-1
-Dcom.sun.management.jmxremote.local.only=false
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This configuration enables unsecured connections! It's definitively not recommended for production!</p></div> <p>You can take a look at all those metrics and their values by connecting to the broker <code>kafka-1</code>.</p> <p><img src="jconsole_screenshot.png" alt="jconsole screenshot"></p> <p>In case you already have a JDK installed on your computer, you can use the prodived <a href="https://openjdk.java.net/tools/svc/jconsole/" target="_blank" rel="noopener noreferrer">Jconsole tool<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> by doing:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">echo</span> <span class="token string">'127.0.0.1 kafka-1'</span> <span class="token operator">&gt;&gt;</span> /etc/hosts
<span class="token variable">$JAVA_HOME</span>/bin/jconsole localhost:1098
</code></pre></div><p>Otherwise, a Docker container is available:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>xhost +
docker-compose -f jconsole.yml up -d
</code></pre></div><p><img src="jconsole_metrics_zoom.png" alt="jconsole metrics"></p> <h2 id="important-metrics"><a href="#important-metrics" class="header-anchor">#</a> Important metrics</h2> <p>All metrics are useful depending on the context and the problems encountered.
During this part, the focus is on the broker metrics. Here are the most important to check and monitor to monitor the health of your Kafka cluster.</p> <table><thead><tr><th>Metrics</th> <th>Description</th></tr></thead> <tbody><tr><td>ActiveControllerCount</td> <td>Number of active controller in the cluster. <strong>There must be only one controller!</strong></td></tr> <tr><td>ZooKeeperExpiresPerSec</td> <td>A Zookeeper session has expired. It can lead to a new leader election or even a new controller election.</td></tr> <tr><td>OfflinePartitionsCount</td> <td>Number of offline partitions. It means that those partitions have no leader anymore and so they are unavailable to read and write operations.</td></tr> <tr><td>ConsumerLag</td> <td>Lag in number of messages per follower replica. This is useful to know if the replica is slow or has stopped replicating from the leader.</td></tr> <tr><td>UnderReplicatedPartitions</td> <td>Number of under-replicated partitions. It indicates the number of partitions that have not a complete list of ISR. You must be alert when this value is greater than zero.</td></tr> <tr><td>IsrShrinksPerSec</td> <td>A shrinkage has occurred to the ISR list. It can be due to a network problem or because a broker goes down.</td></tr> <tr><td>IsrExpandsPerSec</td> <td>It shows an increase in the number of replicas in the ISR list. IsrShrinksPerSec and IsrExpandsPerSec must not change and be equal to zero.</td></tr> <tr><td>BytesInPerSec / BytesOutPerSec</td> <td>Incoming and Outgoing bytes per second, all topics combined. Those metrics do not include ReplicationBytesInPerSec and ReplicationBytesOutPerSec.</td></tr> <tr><td>MessagesInPerSec</td> <td>Incoming message rate per second, all topics combined.</td></tr> <tr><td>UncleanLeaderElectionsPerSec</td> <td>Unclean leader election rate. A new partition leader has been elected which is not from ISR. It's only possible when <code>unclean.leader.election.enable</code> is set to true, default is false</td></tr> <tr><td>RequestHandlerAvgIdlePercent</td> <td>Average fraction of time the request handler threads are idle. Values are between 0 (all resources are used) and 1 (all resources are available).</td></tr> <tr><td>TotalTimeMs request={Produce|FetchConsumer|FetchFollower}</td> <td>Total time in ms to serve the specified request.</td></tr></tbody></table> <hr> <p>How to export all those metrics ?</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/workshop-monitor-kafka/3_OFF_THE_SHELF.html" class="prev">
        Off-the-shelf tools
      </a></span> <span class="next"><a href="/workshop-monitor-kafka/5_JMX_EXPORTER_PROMETHEUS.html">
        JMX Exporter &amp; Prometheus
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/workshop-monitor-kafka/assets/js/app.c1555643.js" defer></script><script src="/workshop-monitor-kafka/assets/js/2.843781b4.js" defer></script><script src="/workshop-monitor-kafka/assets/js/10.40b61c77.js" defer></script>
  </body>
</html>
