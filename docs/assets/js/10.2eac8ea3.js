(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{357:function(e,t,a){"use strict";a.r(t);var r=a(42),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"jmx-metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmx-metrics"}},[e._v("#")]),e._v(" JMX Metrics")]),e._v(" "),a("p",[e._v("By default, Apache Kafka brokers and clients expose a vast array of "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Java_Management_Extensions",target:"_blank",rel:"noopener noreferrer"}},[e._v("JMX"),a("OutboundLink")],1),e._v(" metrics.")]),e._v(" "),a("p",[e._v("JMX is the acronym of Java Management Extensions. It's a standard to manage and monitor Java resources at runtime.")]),e._v(" "),a("h2",{attrs:{id:"browsing-available-metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#browsing-available-metrics"}},[e._v("#")]),e._v(" Browsing available metrics")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://docs.confluent.io/current/kafka/monitoring.html#server-metrics",target:"_blank",rel:"noopener noreferrer"}},[e._v("This documentation page"),a("OutboundLink")],1),e._v(" lists of available metrics on server side and on client side.")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("You should refer to "),a("a",{attrs:{href:"https://docs.confluent.io/current/kafka/monitoring.html#server-metrics",target:"_blank",rel:"noopener noreferrer"}},[e._v("this documentation page"),a("OutboundLink")],1),e._v(" if you're looking for a particular metric")])]),e._v(" "),a("p",[e._v("For this workshop, you are going to browse all available metrics directly on the broker "),a("code",[e._v("kafka-1")]),e._v(". As you may noticed, this broker is configured to enable JMX connection:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("-Dcom.sun.management.jmxremote.ssl=false\n-Dcom.sun.management.jmxremote.authenticate=false\n-Dcom.sun.management.jmxremote.port=1098\n-Dcom.sun.management.jmxremote.rmi.port=1098\n-Djava.rmi.server.hostname=kafka-1\n-Dcom.sun.management.jmxremote.local.only=false\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("This configuration enables unsecured connections! It's definitively not recommended for production!")])]),e._v(" "),a("p",[e._v("You can take a look at all those metrics and their values by connecting to the broker "),a("code",[e._v("kafka-1")]),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"jconsole"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jconsole"}},[e._v("#")]),e._v(" JConsole")]),e._v(" "),a("p",[e._v("If you have a x server running, you can use JConsole. Otherwise, you can go straight to the "),a("a",{attrs:{href:"#JmxTerm"}},[e._v("Jmxterm section")]),e._v(".")]),e._v(" "),a("p",[a("img",{attrs:{src:"jconsole_screenshot.png",alt:"jconsole screenshot"}})]),e._v(" "),a("p",[e._v("In case you already have a JDK installed on your computer, you can use the prodived "),a("a",{attrs:{href:"https://openjdk.java.net/tools/svc/jconsole/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jconsole tool"),a("OutboundLink")],1),e._v(" by doing:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'127.0.0.1 kafka-1'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" /etc/hosts\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$JAVA_HOME")]),e._v("/bin/jconsole localhost:1098\n")])])]),a("p",[e._v("Otherwise, a Docker container is available:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("xhost +\ndocker-compose -f jconsole.yml up -d\n")])])]),a("p",[a("img",{attrs:{src:"jconsole_metrics_zoom.png",alt:"jconsole metrics"}})]),e._v(" "),a("h3",{attrs:{id:"jmxterm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmxterm"}},[e._v("#")]),e._v(" Jmxterm")]),e._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://docs.cyclopsgroup.org/jmxterm",target:"_blank",rel:"noopener noreferrer"}},[e._v("Jmxterm"),a("OutboundLink")],1),e._v(" is an open source command line based interactive JMX client written in Java. It lets user access a Java MBean server in command line console without graphical environment.\nIn another word, it's a command line alternative of jconsole. JMXTerm relies on jconsole library at runtime though.")])]),e._v(" "),a("p",[e._v("Run Jmxterm")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("docker build ./jmxterm/ -t workshop-monitoring-kafka:0.0.1\ndocker run --network"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("kafka-monitoring_workshop -i workshop-monitoring-kafka:0.0.1 -d -t java -jar /bin/jmxterm.jar -l kafka-1:1098\n")])])]),a("p",[e._v("Browse all exposed Mbeans")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("beans\n")])])]),a("p",[e._v("List all domains")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("domains\n")])])]),a("p",[e._v("Switch to a kafka controller domain:")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("domain kafka.controller\nbeans\n")])])]),a("p",[e._v("Switch to a particular bean of interest, let's say "),a("code",[e._v("ActiveControllerCount")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("bean kafka.controller:type"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("KafkaController,name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("ActiveControllerCount\n")])])]),a("p",[e._v("Read the value of the attribute "),a("code",[e._v("Value")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("get Value\n")])])]),a("h2",{attrs:{id:"important-metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#important-metrics"}},[e._v("#")]),e._v(" Important metrics")]),e._v(" "),a("p",[e._v("All metrics are useful depending on the context and the problems encountered.\nDuring this part, the focus is on the broker metrics. Here are the most important to check and monitor to monitor the health of your Kafka cluster.")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Metrics")]),e._v(" "),a("th",[e._v("Description")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("ActiveControllerCount")]),e._v(" "),a("td",[e._v("Number of active controller in the cluster. "),a("strong",[e._v("There must be only one controller!")])])]),e._v(" "),a("tr",[a("td",[e._v("ZooKeeperExpiresPerSec")]),e._v(" "),a("td",[e._v("A Zookeeper session has expired. It can lead to a new leader election or even a new controller election.")])]),e._v(" "),a("tr",[a("td",[e._v("OfflinePartitionsCount")]),e._v(" "),a("td",[e._v("Number of offline partitions. It means that those partitions have no leader anymore and so they are unavailable to read and write operations.")])]),e._v(" "),a("tr",[a("td",[e._v("ConsumerLag")]),e._v(" "),a("td",[e._v("Lag in number of messages per follower replica. This is useful to know if the replica is slow or has stopped replicating from the leader.")])]),e._v(" "),a("tr",[a("td",[e._v("UnderReplicatedPartitions")]),e._v(" "),a("td",[e._v("Number of under-replicated partitions. It indicates the number of partitions that have not a complete list of ISR. You must be alert when this value is greater than zero.")])]),e._v(" "),a("tr",[a("td",[e._v("IsrShrinksPerSec")]),e._v(" "),a("td",[e._v("A shrinkage has occurred to the ISR list. It can be due to a network problem or because a broker goes down.")])]),e._v(" "),a("tr",[a("td",[e._v("IsrExpandsPerSec")]),e._v(" "),a("td",[e._v("It shows an increase in the number of replicas in the ISR list. IsrShrinksPerSec and IsrExpandsPerSec must not change and be equal to zero.")])]),e._v(" "),a("tr",[a("td",[e._v("BytesInPerSec / BytesOutPerSec")]),e._v(" "),a("td",[e._v("Incoming and Outgoing bytes per second, all topics combined. Those metrics do not include ReplicationBytesInPerSec and ReplicationBytesOutPerSec.")])]),e._v(" "),a("tr",[a("td",[e._v("MessagesInPerSec")]),e._v(" "),a("td",[e._v("Incoming message rate per second, all topics combined.")])]),e._v(" "),a("tr",[a("td",[e._v("UncleanLeaderElectionsPerSec")]),e._v(" "),a("td",[e._v("Unclean leader election rate. A new partition leader has been elected which is not from ISR. It's only possible when "),a("code",[e._v("unclean.leader.election.enable")]),e._v(" is set to true, default is false")])]),e._v(" "),a("tr",[a("td",[e._v("RequestHandlerAvgIdlePercent")]),e._v(" "),a("td",[e._v("Average fraction of time the request handler threads are idle. Values are between 0 (all resources are used) and 1 (all resources are available).")])]),e._v(" "),a("tr",[a("td",[e._v("TotalTimeMs request={Produce|FetchConsumer|FetchFollower}")]),e._v(" "),a("td",[e._v("Total time in ms to serve the specified request.")])])])]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("How to export all those metrics ?")])])}),[],!1,null,null,null);t.default=s.exports}}]);